<!doctype html>
<!--[if lt IE 7]> <html class="no-js ie6 oldie" lang="en"> <![endif]-->
<!--[if IE 7]>    <html class="no-js ie7 oldie" lang="en"> <![endif]-->
<!--[if IE 8]>    <html class="no-js ie8 oldie" lang="en"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"> <!--<![endif]-->
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

	<title>Title</title>
	<meta name="description" content="description">
	<meta name="author" content="author">

	<meta name="viewport" content="width=device-width,initial-scale=1">

	<link rel="stylesheet" href="bootstrap/bootstrap.css">

	<link rel="shortcut icon" href="favicon.png">
	<link href="http://fonts.googleapis.com/css?family=Droid+Serif:regular,bold" rel="stylesheet" type="text/css">

	<script src="javascripts/libs/modernizr-2.0.6.min.js"></script>
</head>

<body>

	<div class="container">

		<div id="calendarSearch" class="row">
			<div class="span6 offset4"><input type="text" class="span6" /></div>
			<div class="span2"><button class="btn primary span2">Search</button></div>
		</div>

		<div id="calendarNavigation" class="row">
			<div class="span4"><a href="" class="year">2012</p><a href="" class="previous">&laquo;</a><a href="" class="next">&raquo;</a></div>
			<ul class="span12">
				<li class="past"><a href="">JAN</a></li>
				<li class="past"><a href="">FEB</a></li>
				<li class="past"><a href="">MAR</a></li>
				<li class="future active"><a href="">APR</a></li>
				<li class="future"><a href="">MAY</a></li>
				<li class="future"><a href="">JUN</a></li>
				<li class="future"><a href="">JUL</a></li>
				<li class="future"><a href="">AUG</a></li>
				<li class="future"><a href="">SEP</a></li>
				<li class="future"><a href="">OCT</a></li>
				<li class="future"><a href="">NOV</a></li>
				<li class="future"><a href="">DEC</a></li>
			</ul>
		</div>

		<ul id="calendar" class="row">
			<li id="event-123" class="event event-123" data-event-id="123">
				<div class="row">
					<div class="calendarDate span4">
						<ul>
							<li>
								<div class="calendarIcon timespan">
									<span class="day">28</span><span class="month">APR</span>
									<span class="day">03</span><span class="month">MAY</span>
								</div>
							</li>
							<li>
								<div class="calendarTime">
									<div class="tag">14:00 - 20:00</div>
								</div>
							</li>
						</ul>
					</div>
					<div class="calendarItem span11">
						<h1>This is the title of the charity event</h1>
						<div class="description">
							<p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
						</div>
						<div class="address span5">
							<ul>
								<li>Organisator</li>
								<li>Room 123</li>
								<li>Street with a long name</li>
								<li>CH-8000 Zurich</li>
								<li><button class="btn">Show map</button></li>
							</ul>
						</div>
						<ul class="links span6">
							<li class="link"><a href="http://www.google.com" target="_blank">http://www.google.com</a></li>
							<li class="link"><a href="http://www.link_to_another_site.com" target="_blank">http://www.link_to_another_site.com</a></li>
						</ul>
					</div>
				</div>
				<div class="calendarMap span16" data-address="Zurich, Hardstrasse 219">
					<div id="calendarMap" class="hidden"></div>
				</div>
			</li>
			<li id="event-253" class="event event-253" data-event-id="253">
				<div class="row">
					<div class="calendarDate span4">
						<ul>
							<li>
								<div class="calendarIcon">
									<span class="day">30</span><span class="month">APR</span>
								</div>
							</li>
							<li>
								<div class="calendarTime">
									<div class="tag">14:00</div>
								</div>
							</li>
						</ul>
					</div>
					<div class="calendarItem span12">
						<h1>This is the title of the charity event</h1>
						<div class="description">
							<p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
						</div>
						<div class="address span5">
							<ul>
								<li>Organisator</li>
								<li>Room 123</li>
								<li>Street with a long name</li>
								<li>CH-8000 Zurich</li>
								<li><button class="btn">Show map</button></li>
							</ul>
						</div>
					</div>
				</div>
				<div class="calendarMap span16" data-address="Bern, Bahnhofsplatz"></div>
			</li>
		</ul>

	</div>

<!--	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script> -->
	<script>window.jQuery || document.write('<script src="javascripts/libs/jquery-1.7.1.min.js"><\/script>')</script>

	<script type="text/javascript" src="http://maps.googleapis.com/maps/api/js?sensor=false"></script>

	<script>
		$(window).load(function() {
			var GoogleMap = function(options) {
				var geocoder = new google.maps.Geocoder(),
					map = new google.maps.Map(document.getElementById('calendarMap'), $.extend({
							zoom: 16,
							mapTypeId: google.maps.MapTypeId.ROADMAP
					}, options));

				return {
					search: function(query, cback) {
						geocoder.geocode({'address': query}, function(results, status) {
							if (status == google.maps.GeocoderStatus.OK) {
								map.setCenter(results[0].geometry.location);
								marker = new google.maps.Marker({
									map: map,
									position: results[0].geometry.location
								});

								if (cback && cback.call) {
									cback.call(this, arguments);
								}
							} else {
								console.error("Geocode was not successful for the following reason: " + status);
							}
						});
					}
				};
			};

			var Main = (function($, undefined) {
				var Main = function() {
					var self = this,
						$calendar = $('#calendar'),
						$calendarMap = $('#calendarMap'),
						gMap;

					this.init = function() {
						gMap = new GoogleMap();

						$calendar.find('.address .btn').click(function(evt) {
							var $this = $(this),
								$event = $this.closest('li.event'),
								eventId = $event.data('event-id');

							self.showMap(eventId);
						});
					};

					this.showMap = function(eventId) {
						var $item = $('#event-'+eventId),
							$map = $item.find('.calendarMap'),
							address = $map.data('address');

						$calendarMap.parent().slideUp(400, function(evt) {
							$calendarMap.show();
							$map
								.append($calendarMap.detach())
								.slideDown(400, function(evt) {
									gMap.search(address, function() {

									});
								});
						});

					}

					this.init();
				};

				return new Main();
			})(jQuery);
		});

		$(document).ready(function () {
			$.getJSON('/search', {year: 2011, month: 12}, function (data) {
				$('#tmpl-events').tmpl(data).appendTo("#calendar");
			});
		});
	</script>

	<script>
		window._gaq = [['_setAccount','UA-XXXXXXXX-X'],['_trackPageview'],['_trackPageLoadTime']];
		Modernizr.load({
			load: ('https:' == location.protocol ? '//ssl' : '//www') + '.google-analytics.com/ga.js'
		});
	</script>

	<script src="http://ajax.aspnetcdn.com/ajax/jquery.templates/beta1/jquery.tmpl.min.js"></script>

	<script id="tmpl-event" type="text/x-jquery-tmpl">
	    <li id="event-${_id}" class="event event-${_id}" data-event-id="${_id}">
			<div class="row">
				<div class="calendarDate span4">
						<ul>
							<li>
								<div class="calendarIcon">
									<span class="day">${startDate.day}</span><span class="month">${startDate.month + 1}</span>
								</div>
							</li>
							<li>
								<div class="calendarTime">
									<div class="tag">${startDate.hour}:${startDate.minute}</div>
								</div>
							</li>
						</ul>
					</div>
				<div class="calendarItem span11">
					<h1>${title}</h1>
					<div class="description">
						<p>
							${description}
						</p>
					</div>
					<div class="address span5">
						<ul>
							${location}
							<li><button class="btn">Show map</button></li>
						</ul>
					</div>
				</div>
			</div>
			<div class="calendarMap span16" data-address="${location}">
				<div id="calendarMap" class="hidden"></div>
			</div>
		</li>
	</script>

	<script id="tmpl-events" type="text/x-jquery-tmpl">
		{{tmpl(events) "#tmpl-event"}}
	</script>

	<!--[if lt IE 7 ]>
		<script src="//ajax.googleapis.com/ajax/libs/chrome-frame/1.0.3/CFInstall.min.js"></script>
		<script>window.attachEvent('onload',function(){CFInstall.check({mode:'overlay'})})</script>
	<![endif]-->
</body>
</html>